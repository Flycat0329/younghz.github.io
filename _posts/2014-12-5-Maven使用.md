---
layout: post
title: "Maven 使用"
tagline: "工欲善其事，必先利其器"
description: ""
category: skill
tags: [book]
---
{% include JB/setup %}

## Maven是什么
英文单词为_专家_的意思。    
一款开源的，特别是针对java的构建工具。    
可以执行**清理、编译、测试、打包、部署**一条龙。

## Maven安装(unix 平台)

### 基本安装
> 其中下文中的`version`都是指maven版本，在实际中用安装版本号替代。

##### Maven因为要执行编译等工作，所以依赖于`JDK`,首先查看`JDK`安装：

    echo $JAVA_HOME
    java -version

##### 下载Maven安装文件    

    //移到安装目录
    mv maven-package.tar.gz detination_file
    //解压
    tar xvf maven-package.tar.gz
    //创建符号链接，方便日后升级，一种普适性的软件安装方式，不必每次升级都更新环境变量
    ln -s package_file apache-maven
    
    //设置环境变量，在相应shell rc文件中增加
    export M`version`_HOME=$HOME/.../apache-maven
    export PATH=$HOME:M\__version_\_HOME/bin

##### 检测安装情况

    echo $M`version`_HOME
    mvn -v

### Maven目录结构解析
有bin,boot,conf,lib四个主要文件，其中    
bin:含有mvn运行脚本。    
boot:Maven使用其中的文件加载类库，和用户无关。    
conf:其中包含全局定制Maven行为的文件`setting.xml`,将其copy到用户目录下    

    cp setting.xml ~/.m`version`/

注意setting.xml是用来配置Maven的，而后面所要说的pom.xml使用来配置项目的。    

lib: Maven运行需要的java库

### 设置HTTP代理
通过设置.m`version`文件夹下的settings.xml文件，在文件中增加相应内容（具体内容google）。

### eclipse插件
其插件名为m2eclipse,可通过eclipse->help->install new software安装。

## Maven使用
Maven的使用需遵循特定的文件结构（项目骨架），可用Archetype生成，命令为：

    mvn archetype:gennerate

输入需要的信息：

    groupId:
    //组ID,一般格式如com.google.myapp
    artifactId:
    //项目ID，如hello-world
    version:
    //项目版本，如1.0-SNAPSHOT
    package:
    //如com.mtht.pro

上面三个称为项目基本坐标，是在Maven中区分项目的标志。    
如上生成的Maven基本结构为：    
hello-world文件夹，根目录下用于配置项目的pom.xml，放置项目代码的/src/main/java,放置测试代码的/src/test/java。

### 编写主代码
在src/main/java下编写/com/mtht/pro/helloworld/HelloWorld.java文件。

    package com.mtht.pro.helloworld;
    
    public class HelloWorld
    {
        public String sayHello()
        {
            return "hello maven."
        }
    }

    public static void main(String[] args)
    {
        System.out.println(sayHello());
    }

执行`mvn clean compile`,clean为清理target目录，compile编译代码。

### 编写测试代码
因为要依赖JUnit，所以要在pom.xml中配置，增加dependency:

    ...
    <denpendencies>
      <dependency>
        <groupId>junit<groupId>
        <artfactId>junit<artifactId>
        <version>4.7<version>
        <scope>test<scope>
      </dependency>
    </denpendencies>
    ...

进而编写测试代码。在src/test/java下编写HelloWorldTest.java

    package com.mtht.pro.helloworld;
    
    import static.org.junit.Assert.assertEquals;
    import org.junit.Test

    public class HelloworldTest
    {
        @Test
        public static void main(String[] args)
        {
            HelloWorld helloWorld = new HelloWorld();
            String result = helloWorld.sayHello();
            assertEquals("hello maven.", result);
        }
    }

运行`maven clean test`。

### 打包、安装、运行
运行`mvn clean package`执行打包，生成的jar在target/下。    
若想让maven项目使用到这个包，那么运行`maven clean install`，将jar安装到Maven的repo中。

***
**注意:** 生成的jar文件是不能运行的，可以查看jar中的META-INF/MANIFEST.MF中没有Main-Class一行，为了生成可执行jar文件，需要使用maven-shade-plugin工具，具体配置google。配置完执行`maven clean install`即可。    

***

### Maven其它概念

#### 坐标和依赖
坐标即构件在Maven中的唯一表示。    
依赖即当前项目的dependency，它在pom.xml中定义，Maven有一套管理dependency的机制，能够解决传递性依赖等问题。

#### Maven仓库
* **定义：**统一管理构建的方式，被所有使用Maven的项目共享。其目录为Maven安装目录下的repository文件夹。其中的构件依靠**坐标**唯一进行区分。

* **描述：**仓库分为两类，本地仓库和远程仓库，远程仓库又分为Maven中央仓库，私服和其它公共库。远程仓库是默认配置的，若要是使用其它公共库，则需要在pom.xml中配置repositories字段。本地构建需执行maven install后安装到Maven中才能被是使用。

* **仓库搜索服务**：针对Maven的库的搜索服务: sonatype, jarvana, mvnrepository.


***
几篇很好的资料：    
Apache maven 入门篇（上）    
Apache maven 入门篇（下）
